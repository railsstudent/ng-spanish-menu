import { ChangeDetectionStrategy, Component, EventEmitter, Input, OnDestroy, OnInit, Output } from '@angular/core'
import { FormBuilder, FormControl, FormGroup } from '@angular/forms'
import { Subject } from 'rxjs'
import { takeUntil } from 'rxjs/operators'

import { MenuOptions } from '../enums'

@Component({
  selector: 'app-food-menu-option',
  template: `
    <section class="flex justify-end p-3 pr-0" aria-label="select food section">
      <form [formGroup]="form" aria-label="select food form">
        <select class="pl-2 w-[200px] text-base" name="option" formControlName="option" aria-label="select food">
          <option value="ALL" aria-label="show all">Show all</option>
          <option value="AVAILABLE" aria-label="show available">Show available only</option>
          <option value="LOW_SUPPLY" aria-label="show low supply">Show low supply</option>
          <option value="SOLD_OUT" aria-label="show sold out">Show sold out</option>
        </select>
      </form>
    </section>
  `,
  styles: [
    `
      :host {
        display: block;
      }
    `,
  ],
  changeDetection: ChangeDetectionStrategy.OnPush,
})
export class FoodMenuOptionsComponent implements OnInit, OnDestroy {
  // #region Properties (3)

  @Input()
  menuOption = MenuOptions.ALL
  @Output()
  public menuOptionSelected = new EventEmitter<string>()
  public form: FormGroup
  unsubscribe$ = new Subject<boolean>()

  // #endregion Properties (3)

  // #region Constructors (1)

  constructor(private fb: FormBuilder) {}

  // #endregion Constructors (1)

  // #region Public Methods (2)

  public ngOnDestroy(): void {
    this.unsubscribe$.next(true)
    this.unsubscribe$.complete()
  }

  public ngOnInit(): void {
    this.form = this.fb.group({
      option: new FormControl(this.menuOption),
    })

    this.form.controls['option'].valueChanges
      .pipe(takeUntil(this.unsubscribe$))
      .subscribe((value: string) => this.menuOptionSelected.emit(value))
  }

  // #endregion Public Methods (2)
}
